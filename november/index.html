<!DOCTYPE html>
<html lang="en">
<head>
    <link rel='shortcut icon' href='../img/favicon.ico' type='image/x-icon'/ >

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Data Sketches</title>
    <meta name="author" content="Nadieh Bremer">
    <meta name="description" content="Data Sketches - November - Books">
    <meta name="keywords" content="data, visualization, visualisation, data visualization, data visualisation, information, information visualization, information visualisation, dataviz, datavis, infoviz, infovis, collaboration, data art">

    <!-- Google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Tinos:400,400i|Sacramento|Quicksand|Playfair+Display:400i" rel="stylesheet">

    <!-- jQuery -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <!-- Moment -->
    <script src="http://momentjs.com/downloads/moment.min.js"></script>
    <script src="http://momentjs.com/downloads/moment-timezone-with-data-2010-2020.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

	  <!-- fancyBox -->
	  <link rel="stylesheet" href="../plugins/fancybox/jquery.fancybox.css" type="text/css" media="screen" />
	  <script type="text/javascript" src="../plugins/fancybox/jquery.fancybox.pack.js"></script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../css/style.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>

  <header>
    <!-- Logo and name -->
    <div>
      <a class="hide-mobile peach kingBasil no-border" href="../october"><div class="top-links other-month-link textRight">go to October</div></a>
      <div class="month-logo"><a class="no-border" href=".."><img class="paddingTop20" src="../img/logo.png" width="120" /></a></div>
      <a class="hide-mobile peach kingBasil no-border"><div class="top-links other-month-link textLeft">waiting on December</div></a>
    </div>
    <div>
      <a class="quicksand no-border" href=".."><div class="top-links datasketch-top-link"><span class="dark-grey">data sketch<span class="dark-pink">|</span>es</span></div></a>
    </div>

    <!-- Title above -->
    <div class="row">
      <div class="col-xs-12 month-page-title">
        <h2 class="kingBasil peach">November</h2>
        <h1 class="quicksand">Books</h1>
      </div>
    </div>
  </header>

    <section id="november" class="month-page">
      <div class="nadieh background col-xs-12 col-sm-12 col-md-6 col-lg-6"></div>
      <div class="shirley background col-xs-12 col-sm-12 col-md-6 col-lg-6"></div>

      <div class="container">
        <!-- Write-ups -->
        <div class="row">
          <!-- Nadieh -->
          <div class="col-xs-12 col-md-6 write-up">
            <div class="nadieh">
              <div class="name paddingBelow kingBasil">Nadieh</div>
              <div class="time kingBasil"></div>
              <div class="location quicksand">amsterdam</div>

  			     <!-- <a href="code/nadieh/"><img src="code/nadieh/img/royal_constellations_header.png" class="img-responsive img-month-top" alt="Royal constellations"></a> -->

              <h3 class="margin-top-10">week 1 <span class="light-grey">|</span> data</h3>

			  <p>As a note, this month was very heavy on the data side for me (besides having only 3 weeks due to a vacation at the start of the month). So don't be scared when you see the length of this section ðŸ˜‰</p>
              <p>For a very long time in my youth I only read comic books, but then during a vacation I picked up a copy of Terry Goodkind's <i>The Wizard's First Rule</i> and from that moment on I was hooked on the Fantasy genre. I finally understood the feeling of disappearing inside strange and magical wolds that the authors created through their words (I also had a Manga phase for a few years). So for this month's topic I knew that I wanted to look into Fantasy books.</p>
              <p>Since I don't think it would be very legal to dive into the words of a recent book itself (say, my favorite one), I instead tried to find a different angle. And one thing that struck me is that I always feel that the titles of Fantasy books are somewhat similar. More in terms of subjects to use for titles; about magic (makes sense), or <i>"some name/object of some fantasy place"</i>, such as "The Spears of Laconia". Maybe I could dig into trends and patterns of these titles?</p>
              <p>I thus had to get my hands on a whole bunch of fantasy titles. Scraping the web seemed the fastest way. On Amazon I could find a section that showed the top 100 Fantasy authors from that day. I wrote <a href="data/nadieh/Step 1 - Get the top 100 Fantasy authors from Amazon.R">a small scraper in R</a> with the <a href="https://blog.rstudio.org/2014/11/24/rvest-easy-web-scraping-with-r/" target="_new">rvest package</a> that went through the 5 pages (20 authors per page) and saved their names. However, I couldn't find an easy way to get their most popular books (unique ones) and the Amazon API seemed too much of a hassle. Luckily, Goodreads has a very nice API that can give back the top 30 most popular books per author, together with information about the number of ratings, average rating, publication date and such. I therefore wrote <a href="data/nadieh/Step 2 - Get top books from goodreads.R">another small script</a> with help of the <a href="https://github.com/dsidavis/Rgoodreads" target="_new">rgoodreads package</a> that got back the top 10 most popular books for each of the 100 authors. I first tried 30, but most authors don't have that many and then you start getting back a whole lot of non-English translations of the same book. With 10 per author I only found 2 books that were non-English (I did a quick manual check of the result and deleted those two).</p>
			  <p>Next came the trickiest part, text mining on the titles, which consisted of a few phases: text cleaning, getting hypernyms (I'll explain later) & clustering of similar titles. For the text cleaning I made a few choices. For one, I didn't want any authors that had (co-)written only 1 popular book, based on the number of ratings of Goodreads. So I kept the authors that had a median of >20 ratings on Goodreads. That took out 3 writers, 2 of which had co-written <i>Harry Potter and the Cursed Child</i> with J.K. Rowling. Next, I wasn't looking for any omnibus, a collection, books written by too many people. For this (although not perfect) I looked at how often the exact same book title appeared in my list and took out those that appeared more than twice. Furthermore, I removed all books with terms such as <i>box, set, edition</i> (I checked each of the terms to see that I was removing the right books). Finally, I scrapped books with 0 ratings.</p>
			  <p>Next came the text cleaning. Mostly the basic stuff; removing digits, punctuation, stop words (and some specific words, such as <i>Part</i>). I did a quick word count after the title cleaning to get a sense of what words occur most often in book titles. And since these are words, I of course had to visualize it as a word cloud ðŸ˜‰ The bigger the size of the word, the more often it appears in titles (the location and angle have no meaning).</p>
              <a class="fancybox" href="data/nadieh/most_occuring_words.png"> <img src="data/nadieh/most_occuring_words_small.jpg" class="img-responsive img-month" alt="The most occuring words in Fantasy titles"></a>
			  
			  <p>That was nice, but I wanted to look for trends. And for a standard text mining algorithm, the words <i>wizard</i> and <i>witch</i> are as different as <i>wizard</i> and <i>radio</i>, even though we as humans know better. So I tried to find a way to automatically get hypernyms of nouns, which you can see as a word that lies higher in the hierarchy of concepts I guess. Like a dog, which is a canine, which is a mammal, which is an animal, etc. Maybe on a higher level of concepts, I could replace <i>witch</i> and <i>wizard</i> both with the same term, like <i>magical being</i> or something. I remembered that <a href="https://wordnet.princeton.edu/" target="_new">WordNet</a> might be able to help me with that, but it took me some effort and help from StackOverflow to get it installed on my Mac with Sierra (I wrote about the steps and changes I had to make <a href="data/nadieh/How to install wordnet on a Mac">here</a>).</p>
			  <p>I got the hypernyms per noun into a file and then I saw... it wasn't going to be enough. Besides many not having been given a hypernym, one of the problems was the fact that some words were already "general" enough, but I still requested a hypernym that made it even more general. Other words were still not general enough, I needed the hypernym of the hypernym (or even higher). At this point, and with about 800 different words to "generalize" I just faced the truth and set about doing it manually. The hypernyms that I had did help to classify a word faster. It took me about 2 hours I think, but afterwards I had a list of all the words and their general terms such as <i>a name</i>, <i>magic</i>, <i>location / place</i> and so on.</p>
			  <p>So I took the list back into R, replaced all the specific words with their general ones and then turned the strings of letters into a vector (a document term matrix to be precise, which has each string represented by a row and all of the unique words get a column. There are a few options, but generally a value inside this matrix contains the number of occurrences of that word in the particular title) that I could then use for clustering.</p>
			  <p>Since these titles were very short in number of words, I knew from past experience that the clustering would not really give back amazing results, there's just not enough information. Books with just one fantasy term for example, like <i>Warbreaker</i>, really don't give the algorithm much to compare with others. I therefore tried several things to see which would visually give back the most interesting result. My goal with the clustering was to get back an <i>x</i> and <i>y</i> location for each book, where similar titles were grouped together, that I could then plot in a browser. I tried K-means, Principal Component Analysis (with the 2 most important vectors) & t-SNE with 2 dimensions. Inspecting the results I found that t-SNE gave back the best result. The books were spread out nicely and there were clear groups of different topics (although sometimes a book was placed/clustered too much on one word I found). I quickly placed the most occurring terms on top of t-SNE result to get a feeling for where certain topics were located. This wasn't perfect, since most terms had a hotspot but had a few straggling books around the whole, so some terms were pulled a bit towards the middle. I'd have to "fix" that later.</p>
			  <a class="fancybox" href="data/nadieh/tsne_clustering_result_with_terms.png"> <img src="data/nadieh/tsne_clustering_result_with_terms.png" class="img-responsive img-month" alt="The clustering result of running a t-SNE on the book titles"></a>
			  <p>My very final step was to prepare the data for creating a path between all of the books from the same author. Many books didn't have publication years, so I couldn't do it chronologically sadly. The next best thing was to just draw a line that would create the shortest path, so that the visible length of lines in the final visual would be minimal. Thankfully, I could use the <i>Traveling Salesman Problem</i> approach and the <a href="https://cran.r-project.org/web/packages/TSP/index.html" target="_new">TSP</a> package in R to get the order in which the books should be connected to get the shortest path.</p>
			  <p>The entire process from text cleaning to clustering to TSP can be found <a href="data/nadiehStep 3 - Investigate titles.R">in this file</a>.</p>
			  

              <h3>week 2 <span class="light-grey">|</span> sketches</h3>

              <p>Throughout the data preparation part I was thinking about how I wanted to visualize the results. From the get-go I already had the idea to place the books in a plane representing similarity in titles, hence the clustering. But how to get an interesting shape for the books?</p>
			  <p>Since I was looking at titles, I thought it would be fun to somehow base the resulting "shape" of a book on the title as well. I could split the 360 degrees of a circle in 26 parts, one for each letter in the alphabet (the English language thankfully doesn't really use any accented or "odd" letters), and then place small circles on the correct angles, one for each letter in a title. I would then connect all the letters from a word with curved lines. In the sketch below you can see the idea, where I was still deciding if I wanted the lines, connecting the letters, to only go round around the outside, or through the middle of the circle as well (if the distance between letters was too great).</p> 
			 <a class="fancybox" href="sketches/nadieh/fantasy_books_sketch_1.jpg"> <img src="sketches/nadieh/fantasy_books_sketch_1_small.jpg" class="img-responsive img-month" alt="Figuring out how to visualize the books in an interesting manner"></a>
			  
			  <p>I knew that the lines between the letters would eventually be made through a self written function that creates SVG arc paths. One of the elements that I had to figure out for theses paths is the <i>sweepflag</i> (when you draw a curved line between two points, should you draw it clockwise or counterclockwise? See <a href="http://www.visualcinnamon.com/2015/09/placing-text-on-arcs.html" target="_new">my blog on placing text on arcs</a> for a much more elaborate explanation of what makes up an SVG arc path). Not too difficult, but much easier to figure out if you draw it.</p>
			  <a class="fancybox" href="sketches/nadieh/fantasy_books_sketch_2.jpg"> <img src="sketches/nadieh/fantasy_books_sketch_2_small.jpg" class="img-responsive img-month" alt="Getting the SVG arc sweep angle signs correct"></a>

			  <p>Skipping ahead a bit to a point where I had already started on some simple coding (plotting the book circles, nothing fancy), I looked into the general terms of titles again, such as <i>magic</i> or <i>royal</i>. I knew that placing them in their average location (as in, the average <i>x</i> and <i>y</i> location of all books that contained that term) wasn't quite right. I wanted to have them more on top of their hotspots. Therefore I created simple plots in R that showed me where books relating to a certain term were located (in red below).</p>
			   <a class="fancybox" href="sketches/nadieh/top_term_locations.png"> <img src="sketches/nadieh/top_term_locations_small.jpg" class="img-responsive img-month" alt="Seeing where certain terms cluster within the whole"></a>
			  <p>So when I had a simple SVG of the book locations in my browser, I downloaded the SVG (using <a href="http://nytimes.github.io/svg-crowbar/" tarhet="_new">SVG Crowbar</a>), took that into illustrator and manually (yes, again) started to place ovals for the top ~30 terms that had a clear hotspot. Which resulted in the SVG below that I then copied back into my html file, loading it underneath the book circles.</p>
			  <a class="fancybox" href="sketches/nadieh/term_areas.png"> <img src="sketches/nadieh/term_areas_small.jpg" class="img-responsive img-month" alt="The landscape of the top terms"></a>
			  <p>What this exercise also taught me was that <i>magic</i> is almost everywhere, hence the title of the final visual ðŸ˜‰ </p>
			  <a class="fancybox" href="sketches/nadieh/magic_term.png"> <img src="sketches/nadieh/magic_term.png" class="img-responsive img-month" alt="Words relating to magic are spread throughout the visual"></a>
			  
              <h3>week 3 & 4 <span class="light-grey">|</span> code</h3>

              <p>With the <i>x</i> & <i>y</i> locations finally attached to my books. I could get around to coding it up with d3.js. The start was rather straightforward, just like creating a scatterplot. Through past experience with creating arced paths between locations (like <a href="../october/code/nadieh">my previous month's visual</a>) that went without issues as well. I did size the circles in area according to how many ratings the book had gotten (Goodreads people definitely like J.K. Rowling ðŸ˜„ ). The thickness of the path that connected books of the same author were based on the author's rank in the Amazon top 100.</p>
			  <a class="fancybox" href="code/nadieh/img/books_paths_terms_simple.png"> <img src="code/nadieh/img/books_paths_terms_simple_small.jpg" class="img-responsive img-month" alt="Books plotted and the most common terms"></a>
			  
			  <p>Next, I focused on the book "shape", adding the small circles, one for each letter in a title, around the main book circle and then connecting the letters of one word with a path. I had some fun with these arcs, trying to make them swoosh a bit. The image below is still my favorite visual result, but the paths were getting way too big, obscuring titles and other books. So I tuned it down a bit.</p>
			  <a class="fancybox" href="code/nadieh/img/books_word_swooshes.png"> <img src="code/nadieh/img/books_word_swooshes_small.jpg" class="img-responsive img-month" alt="Big swooshes between two letters of a word"></a>
			  
			  <p>To make the visual a bit more personal, I chose my top 3 authors and my favorite books of these 3 (and 2 others that I enjoyed a series from) and marked these with colors, both in terms of circles and paths.</p>
			  <p>As you can already see from the image above, although the t-SNE algorithm had done a great job of separating the locations of the books, when I resized the books according to their ratings and added the full titles above, many books were overlapping. And since it was important to be able to read the title of a book I wanted to slightly adjust the positions of the circles to reduce overlap. I thought about using the collision algorithm that is in d3 v4's new force layout. But I was afraid that might shuffle the books around too much, their locations within the current layout were rather important. So, yes for a 3rd time, I took the manual approach. I wrote a small function that made it possible to drag each book around (using <i>d3.drag</i>) and then would save the new location in the data. I've since come to love the fact that you can save variables into your local browser (using <i>window.localStorage.setItem('books',JSON.stringify(books))</i> ) so that, even after a refresh, the books would reappear on their moved locations! Surprisingly, it only took me about an hour to slightly shift the ~850 remaining books. With these updated locations I created a new csv (also redid the Traveling Salesman Problem algorithm, just to be sure) and this became the data that is used for the final result.</p>
			  <p>With the updated locations and the term areas added underneath, the visual looked like this</p>
			  <a class="fancybox" href="code/nadieh/img/books_new_locations_term_areas.png"> <img src="code/nadieh/img/books_new_locations_term_areas_small.jpg" class="img-responsive img-month" alt="The new book locations and term areas"></a>
			  
			  <p>Now I really had to think about layout, legends, text, performance (blegh)...</p>

            </div>
          </div>

          <!-- Shirley -->
          <div class="col-xs-12 col-md-6 write-up">
            <div class="shirley">
              <div class="name paddingBelow kingBasil">Shirley</div>
              <div class="time kingBasil"></div>
              <div class="location quicksand">san francisco</div>

              <!-- <a href="http://sxywu.com/obamas" target='_new'><img src="code/shirley/final.png" class="img-responsive img-month-top" alt=""></a> -->

              <h3 class="margin-top-10">week 1 <span class="light-grey">|</span> data</h3>

              <p>So looking forward to this month!</p>

              <!-- <a class="fancybox" href="data/shirley/all_appearances.png"> <img src="data/shirley/all_appearances.png" class="img-responsive img-month"></a> -->

              <h3>week 2 <span class="light-grey">|</span> sketches</h3>

              <p>...</p>

              <h3>week 3 & 4 <span class="light-grey">|</span> code</h3>

              <p>...</p>

            </div>
          </div>

        </div>

        <!-- Our names and website below -->
        <div class="row">
          <div class="nadieh col-xs-6">
            <div class="name kingBasil">Nadieh</div>
            <div class="quicksand"><a href="http://www.visualcinnamon.com/">VisualCinnamon.com</a></div>
          </div>

          <div class="shirley col-xs-6">
            <div class="name kingBasil">Shirley</div>
            <div class="quicksand"><a href="http://sxywu.com/">sxywu.com</a></div>
          </div>
        </div>

      </div>
    </section>

    <footer>
      <div class="container">
        <div>
          <span>a monthly collaboration between </span>
          <span class="kingBasil">Nadieh Bremer & Shirley Wu</span>
        </div>
        <div class="quicksand">
          <a href="https://twitter.com/datasketches">@datasketches</a> | #datasketches
        </div>
        <div class="about-link quicksand">
          <a href="../about">about</a>
        </div>
      </div>
    </footer>

	<script>
  function setTime() {
    var format = 'h:mm a';
    var time = new Date();
    var nadieh = moment(time, format).tz("Europe/Amsterdam");
    var shirley = moment(time, format).tz("America/Los_Angeles");
    $('.nadieh .time').text(nadieh.format(format));
    $('.shirley .time').text(shirley.format(format));

    var nadiehColor = nadieh.hour();
    nadiehColor = nadiehColor >= 18 || nadiehColor <= 6 ? 'dark' : 'light';
    var shirleyColor = shirley.hour();
    shirleyColor = shirleyColor >= 18 || shirleyColor <= 6 ? 'dark' : 'light';

    $('.nadieh').removeClass('light dark').addClass(nadiehColor);
    $('.shirley').removeClass('light dark').addClass(shirleyColor);
  }

  $( document ).ready( function() {
    setTime();
    setInterval(setTime, 60000);
    $(".fancybox").fancybox({
      openEffect : 'fade',
      closeEffect : 'fade',
      padding: 0,
      helpers: {
      overlay: {
        locked: false
      }
      }
    });
  });
	</script>

  </body>
</html>
